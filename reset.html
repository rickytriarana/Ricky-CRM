<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Reset Arana CRM</title>
  <meta name="theme-color" content="#1f2a44" />
  <style>
    body{font-family:system-ui;margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;background:#0b1022;color:#e5e7eb;padding:18px}
    .card{max-width:520px;border:1px solid #24314f;border-radius:16px;padding:16px;background:rgba(17,27,52,.6)}
    .muted{color:#94a3b8;font-size:13px;line-height:1.4}
    code{background:rgba(0,0,0,.3);padding:2px 6px;border-radius:8px}
  </style>
</head>
<body>
  <div class="card">
    <h2 style="margin:0 0 8px 0">Reset Arana CRM (PWA)</h2>
    <div class="muted">
      Halaman ini akan:<br/>
      1) Unregister service worker<br/>
      2) Hapus Cache Storage<br/>
      3) Redirect ke <code>/?v=4</code><br/><br/>
      Jika tidak redirect dalam 10 detik, reload halaman ini.
    </div>
    <div id="log" class="muted" style="margin-top:10px"></div>
  </div>

<script>
(async function(){
  const logEl = document.getElementById("log");
  const log = (m)=>{ logEl.innerHTML += m + "<br/>"; };

  try{
    if ("serviceWorker" in navigator){
      const regs = await navigator.serviceWorker.getRegistrations();
      for (const r of regs){ await r.unregister(); }
      log("✓ Service worker unregistered");
    } else {
      log("! Service worker not supported");
    }
  }catch(e){ log("! SW error: " + e); }

  try{
    if (window.caches){
      const keys = await caches.keys();
      await Promise.all(keys.map(k => caches.delete(k)));
      log("✓ Cache storage cleared");
    }
  }catch(e){ log("! Cache error: " + e); }

  setTimeout(()=>{ location.href = "./?v=4&ts=" + Date.now(); }, 800);
})();
</script>
</body>
</html>
